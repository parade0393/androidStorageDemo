```kotlin
    fun saveFile() {
        if (checkPermission()) {
            //getExternalStoragePublicDirectory被弃用，分区存储开启后就不允许访问了
            val filePath = Environment.getExternalStoragePublicDirectory("").toString() + "/test3.txt"
            val fw = FileWriter(filePath)
            fw.write("hello world")
            fw.close()
            showToast("文件写入成功")
        }
    }
```
### 针对上述代码分情况运行：
1） targetSdkVersion = 28，运行后正常读写。
2） targetSdkVersion = 29，不删除应用，targetSdkVersion 由28修改到29，覆盖安装，运行后正常读写。
3） targetSdkVersion = 29，删除应用，重新运行，读写报错，程序崩溃（open failed: EACCES (Permission denied)）
4） targetSdkVersion = 29，添加android:requestLegacyExternalStorage="true"（不启用分区存储），删除应用，重新运行,读写正常不报错
5） targetSdkVersion = 30，不删除应用，targetSdkVersion 由29修改到30，读写报错，程序崩溃（open failed: EACCES (Permission denied)）
6） targetSdkVersion = 30，不删除应用，targetSdkVersion 由29修改到30，增加android:preserveLegacyExternalStorage="true"，读写正常不报错
7） targetSdkVersion = 30，删除应用，重新运行，读写报错，程序崩溃（open failed: EACCES (Permission denied)）

### Android Q规定了APP有两种外部存储空间视图模式：Legacy View、Filtered View。
    * Legacy View 兼容模式。与AndroidQ之前一样，申请权限后App可访问外部存储，拥有完整的访问权限，可以使用File的方式访问文件
    * Filtered View 分区存储。APP只能直接访问App-specific目录，访问公共目录或者其他APP的App-specific目录，只能通过MediaStore、SAF、或者其他APP提供的ContentProvider、FileProvider等方式访问
    * 在AndroidQ上，target SDK大于或等于29的APP默认被赋予Filtered View。APP可以在AndroidManifest.xml中设置requestLegacyExternalStorage来修改外部存储空间视图模式，true为Legacy View，false为Filtered View
    * 在Android 11以上，强制是Filtered View
    * 可以通过Environment.isExternalStorageLegacy()方法判断运行模式

### 外部存储空间被分为两部分
* App-specific directory 沙盒目录
    * APP只能在Context.getExternalFilesDir()目录下通过File的方式创建文件，APP卸载的时候，这个目录下的文件会被删除
    * 其他路径下无法通过File的方式创建文件----无需任何权限
* 2.Public Directory 公共目录，处理文件不能用file，必须用Uri
    * 公共目录包括：多媒体公共目录（photos, images, videos, audio）和下载文件目录（Downloads）
    * APP通过MediaStore或者SAF（System Access Framework）的方式访问其中的文件
    * APP卸载后，文件不会被删除
    * 通过MediaStore访问其他应用创建的多媒体文件的时候，需要READ_EXTERNAL_STORAGE权限
    
对于androidQ 来说，没有filePath这个东西了，只有自己沙盒中的文件才能用filepath，其他地方只能用uri,所以文件管理器上传文件需要处理兼容10以上
对于androidQ 来说，没有WRITE_EXTERNAL_STORAGE权限
对于androidQ 以后来说，要使用ContentResolver来读取和保存文件